# 户型图卫生间尺寸提取 - 提示词优化指南

## 问题分析

通过分析原始提示词和两张示例户型图，我们发现了以下主要问题：

1. **任务范围不明确**：原提示词没有明确说明需要提取所有卫生间的信息
2. **标尺读取指导不足**：对如何准确读取标尺的说明过于简略
3. **缺少错误处理**：没有考虑特殊情况的处理方法
4. **示例不够具体**：虽然有例子，但缺少视觉引导

## 优化策略

### 1. 优化版本1：详细指导版 (`floorplan_detection_prompt_optimized.py`)

**特点**：
- 提供了完整的5步操作流程
- 详细说明了每个步骤的具体操作
- 包含特殊情况处理
- 标准化的输出格式

**适用场景**：
- 模型理解能力一般，需要详细指导
- 首次使用，需要了解完整流程
- 对准确性要求高的场景

### 2. 优化版本2：简洁高效版 (`floorplan_detection_prompt_concise.py`)

**特点**：
- 精简的核心方法说明
- 使用CoT（思维链）引导
- 重点突出关键技巧

**适用场景**：
- 模型理解能力强
- 需要快速响应
- 已熟悉基本流程

### 3. 优化版本3：视觉引导版 (`floorplan_detection_prompt_visual.py`)

**特点**：
- 强调视觉特征识别
- 提供视觉对齐技巧
- 交互式引导流程

**适用场景**：
- 视觉理解能力强的模型
- 复杂户型图分析
- 需要更好的空间理解

## 关键优化点

### 1. 标尺读取方法优化
```
原版：辅助线与标尺的交点之间可能包含多段双向箭头
优化：
- 明确说明如何找到对齐的标尺段
- 详细解释多段累加的情况
- 强调单位转换（mm→m）
```

### 2. 多目标处理
```
原版：只关注单个卫生间
优化：明确要求识别并处理所有卫生间
```

### 3. 输出格式标准化
```
优化后格式：
卫生间[名称]：
- 面积：X.X平方米
- 长：X.XXXm
- 宽：X.XXXm
- 验证：X.XXX × X.XXX = X.X ✓
```

## 使用建议

1. **先测试简洁版**：如果效果好，就使用简洁版以节省token
2. **效果不佳时用详细版**：提供更多指导信息
3. **复杂图纸用视觉版**：帮助模型更好理解空间关系
4. **组合使用**：可以将不同版本的优点组合

## 进一步优化方向

1. **Few-shot Learning**：提供更多不同类型的户型图示例
2. **错误案例分析**：加入常见错误和纠正方法
3. **后处理验证**：添加结果验证逻辑，自动检查计算准确性
4. **模型特定优化**：根据不同模型的特点调整提示词风格

## 性能对比测试

建议使用以下指标评估不同版本的效果：
- 识别准确率（是否找到所有卫生间）
- 面积提取准确率
- 尺寸计算准确率
- 响应时间
- Token使用量
